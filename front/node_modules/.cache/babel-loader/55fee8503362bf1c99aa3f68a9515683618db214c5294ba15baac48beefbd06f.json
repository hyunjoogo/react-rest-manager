{"ast":null,"code":"import { initializeApp } from \"firebase/app\";\nimport { getAuth, GoogleAuthProvider, onAuthStateChanged, signInWithPopup, signOut } from \"firebase/auth\";\nimport { get, getDatabase, ref, update } from \"firebase/database\";\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_AUTH_DOMAIN,\n  databaseURL: process.env.REACT_APP_DATABASE_URL,\n  projectId: process.env.REACT_APP_PROJECT_ID\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\nconst auth = getAuth();\nconst provider = new GoogleAuthProvider();\nconst database = getDatabase(app);\nexport const login = () => {\n  signInWithPopup(auth, provider).catch(console.error);\n};\nexport function logout() {\n  signOut(auth).catch(console.error);\n}\nexport const onUserStateChange = callback => {\n  onAuthStateChanged(auth, async user => {\n    const updatedUser = user ? await adminUser(user) : null;\n    callback(updatedUser);\n  });\n};\n\n// TODO onValue로 하는 방법 알아보기\nconst adminUser = async user => {\n  // 2. 사용자가 어드민 권한을 가지고 있는지 확인!\n  // 3. {...user, isAdmin : true/false}\n  return get(ref(database, 'admins')).then(snapshot => {\n    if (snapshot.exists()) {\n      const admins = snapshot.val();\n      const isAdmin = admins.includes(user === null || user === void 0 ? void 0 : user.uid);\n      return {\n        ...user,\n        isAdmin\n      };\n    }\n    return user;\n  }).catch(error => {\n    console.error(error);\n  });\n};\nexport const getMyRest = async userUid => {\n  // TODO userUid 파라미터로 받아오기\n  if (typeof userUid === \"undefined\") {\n    return Promise.reject(new Error('로그인을 해주세요!'));\n  }\n  return get(ref(database, `user/${userUid}`)).then(snapshot => {\n    if (snapshot.exists()) {\n      return snapshot.val();\n    }\n    return [];\n  });\n};\nexport const writeMyRest = async data => {\n  // TODO userUid 파라미터로 받아오기\n  const userUid = \"61PnszykzXN643UrVfEaSQCDiEw1\";\n  return update(ref(database, `user/${userUid}/myRestList`), data);\n};\nexport const sortMyRest = async selectedDate => {\n  const userUid = \"61PnszykzXN643UrVfEaSQCDiEw1\";\n  get(ref(database, `user/${userUid}/restRemainDay`)).then(snapshot => {\n    if (snapshot.exists()) {\n      return snapshot.val();\n    }\n    return [];\n  }).then(result => {\n    const temp = {\n      ...result\n    };\n    Object.keys(selectedDate).forEach(value => {\n      const day = selectedDate[value];\n      temp[day.category].remainDay -= day.deduction;\n    });\n    update(ref(database, `user/${userUid}/restRemainDay`), temp);\n  });\n};","map":{"version":3,"names":["initializeApp","getAuth","GoogleAuthProvider","onAuthStateChanged","signInWithPopup","signOut","get","getDatabase","ref","update","firebaseConfig","apiKey","process","env","REACT_APP_FIREBASE_API_KEY","authDomain","REACT_APP_AUTH_DOMAIN","databaseURL","REACT_APP_DATABASE_URL","projectId","REACT_APP_PROJECT_ID","app","auth","provider","database","login","catch","console","error","logout","onUserStateChange","callback","user","updatedUser","adminUser","then","snapshot","exists","admins","val","isAdmin","includes","uid","getMyRest","userUid","Promise","reject","Error","writeMyRest","data","sortMyRest","selectedDate","result","temp","Object","keys","forEach","value","day","category","remainDay","deduction"],"sources":["/Users/hyunjoo/cording/typescript/react-rest-manager/front/src/api/firebase.ts"],"sourcesContent":["import {initializeApp} from \"firebase/app\";\nimport {getAuth, GoogleAuthProvider, onAuthStateChanged, signInWithPopup, signOut} from \"firebase/auth\";\nimport {get, getDatabase, ref, set, push, update, child, query, orderByChild} from \"firebase/database\";\nimport {User} from \"@firebase/auth\";\nimport {MyRestListType, MyRestType} from \"../components/type/type\";\nimport {limitToFirst} from \"@firebase/database\";\nimport {SelectedDateTypes} from \"../pages/add-page\";\n\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_AUTH_DOMAIN,\n  databaseURL: process.env.REACT_APP_DATABASE_URL,\n  projectId: process.env.REACT_APP_PROJECT_ID\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\nconst auth = getAuth();\nconst provider = new GoogleAuthProvider();\nconst database = getDatabase(app);\n\n\nexport const login = () => {\n  signInWithPopup(auth, provider).catch(console.error);\n};\n\nexport function logout() {\n  signOut(auth).catch(console.error);\n}\n\n\n\nexport const onUserStateChange = (callback: any) => {\n  onAuthStateChanged(auth, async (user) => {\n    const updatedUser: any = user ? await adminUser(user) : null;\n    callback(updatedUser);\n  });\n};\n\n// TODO onValue로 하는 방법 알아보기\nconst adminUser = async (user: User | null) => {\n  // 2. 사용자가 어드민 권한을 가지고 있는지 확인!\n  // 3. {...user, isAdmin : true/false}\n  return get(ref(database, 'admins'))\n    .then((snapshot) => {\n      if (snapshot.exists()) {\n        const admins = snapshot.val();\n        const isAdmin: boolean = admins.includes(user?.uid);\n        return {...user, isAdmin};\n      }\n      return user;\n    }).catch((error) => {\n      console.error(error);\n    });\n};\n\n\nexport const getMyRest = async (userUid : string | undefined) => {\n  // TODO userUid 파라미터로 받아오기\n  if (typeof userUid === \"undefined\") {\n    return Promise.reject(new Error('로그인을 해주세요!'));\n  }\n  return get(ref(database, `user/${userUid}`))\n    .then((snapshot) => {\n      if (snapshot.exists()) {\n        return snapshot.val();\n      }\n      return [];\n    });\n};\n\nexport const writeMyRest = async (data: MyRestListType) => {\n  // TODO userUid 파라미터로 받아오기\n  const userUid = \"61PnszykzXN643UrVfEaSQCDiEw1\";\n  return update(ref(database, `user/${userUid}/myRestList`), data);\n};\n\nexport const sortMyRest = async (selectedDate: SelectedDateTypes) => {\n  const userUid = \"61PnszykzXN643UrVfEaSQCDiEw1\";\n  get(ref(database, `user/${userUid}/restRemainDay`))\n    .then((snapshot) => {\n      if (snapshot.exists()) {\n        return snapshot.val();\n      }\n      return [];\n    }).then(result => {\n    const temp = {...result};\n    Object.keys(selectedDate).forEach(value => {\n      const day = selectedDate[value as keyof SelectedDateTypes]!;\n      temp[day.category].remainDay -= day.deduction;\n    });\n    update(ref(database, `user/${userUid}/restRemainDay`), temp);\n  });\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}